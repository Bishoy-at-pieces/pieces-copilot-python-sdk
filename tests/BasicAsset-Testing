import pytest
from unittest.mock import Mock, patch, MagicMock
from pieces_os_client import Asset, Format, ClassificationGenericEnum, ClassificationSpecificEnum, Annotations, Annotation
from datetime import datetime
import sys
import importlib.util
from asset import BasicAsset
from ..streamed_identifiers.assets_snapshot import AssetSnapshot
from .client import PiecesClient

class BasicAsset(BasicAsset):
    def __init__(self, id) -> None:
        self.asset:Asset = AssetSnapshot.identifiers_snapshot.get(id)
        if not self.asset:
            print(f"Asset not found for ID: {id}")
            print("Available IDs in AssetSnapshot.identifiers_snapshot:", AssetSnapshot.identifiers_snapshot.keys())
            raise ValueError("Asset not found")

@pytest.fixture(scope="function")
def pieces_client():
    return PiecesClient(config={'baseUrl': 'http://localhost:1000/'})

@pytest.fixture(scope="function", autouse=True)
def setup_asset_snapshot(pieces_client):
    AssetSnapshot.identifiers_snapshot = {}
    print("Before test:", AssetSnapshot.identifiers_snapshot)
    yield
    print("After test:", AssetSnapshot.identifiers_snapshot)
    AssetSnapshot.identifiers_snapshot = {}
